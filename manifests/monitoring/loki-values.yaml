loki:
  enabled: true
  service:
    type: NodePort
    nodePort: 31000

promtail:
  enabled: true

  config:
    server:
      log_level: info
      http_listen_port: 3101

    clients:
      - url: http://loki:3100/loki/api/v1/push

    positions:
      filename: /run/promtail/positions.yaml

    scrape_configs:
      - job_name: kubernetes-pods
        pipeline_stages:
          - cri: {}

        kubernetes_sd_configs:
          - role: pod

        relabel_configs:
          - action: replace
            source_labels:
              - __meta_kubernetes_namespace
            target_label: namespace

          - action: replace
            source_labels:
              - __meta_kubernetes_pod_name
            target_label: pod

          - action: replace
            source_labels:
              - __meta_kubernetes_pod_container_name
            target_label: container

          - action: replace
            replacement: /var/log/pods/*$1/*.log
            separator: /
            source_labels:
              - __meta_kubernetes_pod_uid
              - __meta_kubernetes_pod_container_name
            target_label: __path__

grafana:
  enabled: true
  service:
    type: NodePort
    nodePort: 30300

  adminPassword: "admin"

  sidecar:
    datasources:
      enabled: true

  image:
    tag: latest
